name: demo-ms-intercomunicacao
namespace: demo
image: paulofponciano/demo-ms-intercomunicacao:latest
replicas: 1

env:
  - name: TITLE
    value: "Microservice 1"
  - name: RESPONSE_TIME
    value: "500"
  - name: EXTERNAL_CALL_URL
    value: ""
  - name: EXTERNAL_CALL_METHOD
    value: "GET"
  - name: APP_VERSION
    value: "0.1.0"

livenessProbe:
  enabled: true
  path: /healthz
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 5

readinessProbe:
  enabled: true
  path: /ready
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 5

service:
  portName: http
  port: 5000
  protocol: TCP
  targetPort: 5000

istio:
  virtualService:
    enabled: true
    protocol: http
    retries:
      attempts: 2
      perTryTimeout: 500ms
      retryOn: connect-failure,refused-stream,unavailable,cancelled,503
  gateway:
    enabled: false
    name: demo-ms-1-gateway
    host: demo-ms-intercomunicacao.sevira.cloud
    selector: ingressgateway

# Rollout strategy: canary or blueGreen
strategy:
  type: blueGreen
  canary:
    steps:
    - setWeight: 0
    - pause: { }
    - setWeight: 10
    - pause: { }
    - setWeight: 20
    - pause: { }
    - setWeight: 40
    - pause: { }
    - setWeight: 80
    - pause: { }
    - setWeight: 100
  blueGreen:
    activeService: demo-ms-intercomunicacao
    previewService: demo-ms-intercomunicacao-green
    autoPromotionEnabled: false

prometheus:
  scrape: true
  path: /metrics
  port: 5000
